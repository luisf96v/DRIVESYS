<!DOCTYPE HTML>
<html>

<head>
    <meta name="viewport" content="width=device-width" />
    <title>DOCSYS - Ver Archivos</title>
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
    <link href="/stylesheets/indexUsr.css" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/style.css" rel="stylesheet" type="text/css" />
    <link href="stylesheets/general.css" rel="stylesheet" type="text/css" />
    <link href="stylesheets/tooltip.css" rel="stylesheet" type="text/css" />
    <link href="stylesheets/snackbar.css" rel="stylesheet" type="text/css" />
    <!--link href="/javascripts/jquerySimpleFilePreview/jquerySimpleFilePreview.css" rel="stylesheet" type="text/css" /-->
    <script src="/javascripts/modernizr-custom.js" type="text/javascript"></script>
    <script src="/javascripts/DataTables/datatables.js" type="text/javascript"></script>
    <script src="/javascripts/jquerySimpleFilePreview/jquery.simpleFilePreview.js" type="text/javascript"></script>
    <script src="/javascripts/snackbar.js" type="text/javascript"></script>
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.3.1/css/all.css">
    <link rel="stylesheet" href="//cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="//cdn.datatables.net/responsive/2.2.3/css/responsive.bootstrap.min.css">
</head>

<body>
    <nav class="navbar navbar-inverse top-bar navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#myNavbar"
                    id="mnvar" aria-expanded="false">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button> <span class="menu-icon" id="menu-icon" style="line-height: 30px; width: 50px"><i
                        class="fa fa-bars" aria-hidden="true" id="chang-menu-icon"></i></span>
                <a class="navbar-brand mx-auto mx-auto-top" href="#"
                    style="text-shadow: 0 0 5px black, 0 0 10px rgba(0,0,0,.3);color: white; font-size: 30px; vertical-align: middle; line-height: 30px">DOC<span
                        style="text-shadow: 0 0 3.5px black; color: #3399ff">SYS</span></a>
            </div>
            <div class="collapse navbar-collapse navbar-right" id="myNavbar">
                <ul class="nav navbar-nav">
                    <li class=""><a href="#"><i class="fa fa-refresh"></i> Empezar Tour</a> </li>
                    <li class=""><a href="#"><i class="fa fa-bell"></i> <span class="badge">9</span></a> </li>
                    <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" data-target="#dropOpt"
                            href="#">Opciones
                        </a>
                    </li>
                    <ul class="dropdown-menu" style="position: absolute" id='dropOpt'>
                        <li> <a href="#"><i class="fa fa-user"></i> Perfil</a> </li>
                        <li> <a href="#"><i class="fa fa-cog"></i> Preferencias</a> </li>
                        <li> <a href="#"><i class="fa fa-power-off"></i> Salir</a> </li>
                    </ul>
                </ul>
            </div>
        </div>
    </nav>
    <!--    top nav end===========-->
    <div class="wrapper" id="wrapper">
        <div class="left-container" id="left-container">
            <!-- begin SIDE NAV USER PANEL -->
            <div class="hide-sidebar" id="show-nav">
                <ul id="side" class="side-nav">
                    <li class="panel">
                        <a id="panel1" href="javascript:;" data-toggle="collapse" data-target="#Dashboard"> <i
                                class="fa fa-home"></i> Inicio
                            <i class="fa fa-chevron-left pull-right" id="arow1"></i> </a>
                        <ul class="collapse nav" id="Dashboard">
                            <li> <a href="" id="history"><i class="fa fa-angle-double-right"></i> Usuarios</a> </li>
                            <li> <a href="" id="bills"><i class="fa fa-angle-double-right"></i> Archivos</a> </li>
                        </ul>
                    </li>
                    <li class="panel">
                        <a id="panel9" href="javascript:;" data-toggle="collapse" data-target="#trash"> <i
                                class="fa fa-trash"></i> Papelera de reciclaje
                        </a>
                    </li>
                </ul>
            </div>
            <!-- END SIDE NAV USER PANEL -->
        </div>
        <div class="right-container full-width" id="right-container">
            <div class="container-fluid" id="mainContainer">
                <div class="row">
                    <div class="col-md-12" id='navigation'>
                        <ol class="breadcrumb">
                            <li><i class="fa fa-home"></i><a href=""> Inicio </a></li>
                            <li>Mesa de trabajo</li>
                            <li class="active" onclick="rollback(0, $(this))" >Raíz</li>
                        </ol>
                    </div>

                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="main-header">
                            <h2>Mesa de trabajo</h2>
                            <em>Administrador</em>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <table id='tableReview' class='table table-striped nowrap'
                    style="width:100%; background-color: white; border: 1px solid #ddd; text-align: left; outline: 2px solid rgb(197, 197, 197);">
                    <thead style="background-color: #337ab7; color: white">
                        <tr>
                            <td style="width:50%">
                                <p>Nombre</p>
                            </td>
                            <td style="min-width: 30px">
                                <p>Tipo</p>
                            </td>
                            <td style="min-width: 50px">
                                <p>Tamaño</p>
                            </td>
                            <td style="min-width: 120px; padding-right: 30px !important; max-width: 120px !important;">
                                <p style="text-align: unset; width:120px">Última modificacion</p>
                            </td>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>

        <div id="modalRow1" class="modal" tabindex="-1" role="dialog">
                <div class="modal-dialog" role="document">
                    <div class="modal-content" style="margin-top: calc(50vh - 170px) !important;">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <h2 class="modal-title" id="modalTittle1"> </h2>
                        </div>
                        <div class="modal-body" style="text-align: center;" id="modalBody1">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" id='saveC'>Descargar</button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                        </div>
                    </div>
                </div>
            </div>
        <script>

            function returnFileSize(number) {
                if (number < 1024) {
                    return number + 'bytes';
                } else if (number >= 1024 && number < 1048576) {
                    return (number / 1024).toFixed(1) + 'KB';
                } else if (number >= 1048576) {
                    return (number / 1048576).toFixed(1) + 'MB';
                }
            }
            var currentRow = 0;
            window.tree = []
            window.current = 0
            tree[current] = []
            var $form = $('.box');
           

            const tableFromDataRemovable = files => Array.from(files) //hacer not removable
                .reduce((z, e, i, arr) => z +
                    "<tr><td>" +
                    e.name +
                    "</td><td>" +
                    (e.name.split('.').length == 1 ? 'Archivo' : e.name.split('.').pop()) +
                    "</td><td>" +
                    returnFileSize(e.size) +
                    "</td><td><span class='fa fa-window-close' style='margin-left:10%; color: #FF5722' onclick='deleteFile(`" + e.name + "`, $(this))'></span></td></tr>" +
                    (i == arr.length - 1 ? "</tbody>" : ""),
                    '<thead style="background-color: #337ab7; color: white"> <tr><td style="width:70%">Nombre</td><td>Tipo</td><td>Tamaño</td><td>Quitar</td></tr></thead><tbody>')


            const rollback = (before, element) => {
                if(!element.hasClass('active')){
                    t.clear()
                    current = before;
                    tree[before].forEach(e=>t.row.add(e).draw(false));
                    updateTableListener();
                    element.parent().children().toArray().slice(before+3).forEach(e=>$(e).remove());
                    element.addClass('active')
                }
            }
            var clicks = 0
            const updateTableListener = () =>
                $('#tableReview tbody tr td').unbind('click').on('click',e => {
                    clicks++;
                    if(clicks>=2){
                        clearTimeout()
                        current++
                        tree[current] = []
                        
                        $('.breadcrumb li').removeClass("active");
                        $($('.breadcrumb').toArray()[0]).append($("<li class='active' onclick=rollback("+current+",$(this))/>").append($(e.target).parent().children().first()[0].firstChild.innerText))
                        t.clear().draw()
                    }
                    setTimeout(()=>{clicks=0},500)
                    if($(e.target).parent().children().toArray()[1]+"".toLowerCase()=='carpeta'){
                        insertDataDM($(e.target).parent().children().toArray().map(e => $(e)))
                    }
                });

            $('document').ready(() => {
                window.t = $('#tableReview').DataTable({
                    fixedHeader: {
                        header: true,
                        footer: true
                    },
                    language: {
                        "sProcessing": "Procesando...",
                        "sLengthMenu": "Mostrar _MENU_ registros",
                        "sZeroRecords": "No se encontraron resultados",
                        "sEmptyTable": "Ningún dato disponible en esta tabla",
                        "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                        "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                        "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
                        "sInfoPostFix": "",
                        "sSearch": "Buscar:",
                        "sUrl": "",
                        "sInfoThousands": ",",
                        "sLoadingRecords": "Cargando...",
                        "oPaginate": {
                            "sFirst": "Primero",
                            "sLast": "Último",
                            "sNext": "Siguiente",
                            "sPrevious": "Anterior"
                        },
                        "oAria": {
                            "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                            "sSortDescending": ": Activar para ordenar la columna de manera descendente"
                        }
                    }
                });

                updateTableListener()
                
                const insertDataDM = (e) => {
                    $("#modalTittle1").html("Dialogo de descarga para " + e[0].html())
                    e.shift()
                    e.pop()
                    $("#modalBody1").html(getTableData(e))
                    $("#modalRow1").modal()
                }
                const getTableData = info => {
                    colNames = ['Tipo', 'Tamaño']
                    data = info.reduce((z, e, i) => z + '<tr><td>' + colNames[i] + ':' + '</td><td>' + e.html() + '</td></tr>', "")
                    return $("<div class='container' style='max-width: 90%'/>").append($('<table class="table table-bordered"/>').append(data)[0])
                }
                $('#foldertd').css('display', 'table-cell !important')

                const monthNames = ["Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"];

            })

        </script>
        <script src="/javascripts/indexUsr.js" type="text/javascript"></script>

</html>